# Capability Providers Configuration
# Version: 1.0.0
# Purpose: Model-agnostic provider abstraction for workflow capabilities
#
# This file defines which implementation to use for each capability.
# Set to "auto" for automatic detection based on model self-awareness,
# or force a specific provider when you know your environment.
#
# When "auto": Claude detects its model and available tools at runtime
# When explicit: Forces the specified provider regardless of model

providers:

  # --- Parallelization ---
  # How multiple agents work simultaneously
  #
  # agent-teams: Native Claude Code Agent Teams (Opus 4.6+, requires CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1)
  #   - Independent Claude sessions with own context windows
  #   - Direct inter-agent communication via shared task list
  #   - TeammateTool for spawning teammates
  #   - Orchestrator coordinates work
  #
  # worktrees: Git worktrees + tmux (any model)
  #   - Filesystem-level isolation via git worktrees
  #   - tmux panes for visual separation
  #   - Manual coordination via 50_state.md + git sync
  #   - Requires: tmux >= 3.0, git >= 2.30
  #
  parallelization: auto  # auto | agent-teams | worktrees

  # --- Context Management ---
  # How context window exhaustion is handled
  #
  # compaction-aware: Leverages server-side Compaction API (Opus 4.6+)
  #   - Relaxed thresholds (context is auto-summarized by API)
  #   - pre_compact.sh hook still fires for state preservation
  #   - Snapshot/restore available but less critical
  #   - Supports 200K default, 1M beta context windows
  #
  # manual-snapshots: Manual snapshot/restore cycle (any model)
  #   - Strict 70% rule with proactive compaction
  #   - token-advisor for monitoring
  #   - Frequent checkpoints recommended
  #   - Conservative thresholds (20 files, 50 messages, 2 hours)
  #
  context_management: auto  # auto | compaction-aware | manual-snapshots

  # --- Context Isolation (Fork Strategy) ---
  # When to use context: fork for skills and agents
  #
  # selective: Fork only truly heavy operations (Opus 4.6+ with 200K/1M context)
  #   - Fork when: cross-codebase analysis, external integrations, >30 files
  #   - Inline when: focused review, <15 files, single-domain analysis
  #   - Reason: Larger context window tolerates more inline analysis
  #
  # aggressive: Fork all analysis operations (any model)
  #   - All 7 review agents forked
  #   - All 7 heavy skills forked (consultant, coverage-checker, etc.)
  #   - Reason: Protect limited context window at all costs
  #
  fork_strategy: auto  # auto | selective | aggressive

  # --- Coordination ---
  # How agents communicate and share state
  #
  # Note: 50_state.md is ALWAYS used regardless of provider.
  # This setting controls the ADDITIONAL coordination layer.
  #
  # native-plus-state: Agent Teams communication + 50_state.md (Opus 4.6+)
  #   - Shared task list (in-memory, managed by orchestrator)
  #   - Direct teammate communication
  #   - 50_state.md for persistent state across sessions
  #
  # state-plus-git: 50_state.md + git sync (any model)
  #   - All coordination via file-based state
  #   - Git commits as synchronization points
  #   - /workflows:sync for explicit state sharing
  #
  coordination: auto  # auto | native-plus-state | state-plus-git

# --- Thresholds ---
# Override default thresholds based on your model's capabilities.
# When null, the provider auto-selects appropriate values.

thresholds:

  # Context management thresholds
  context:
    # Percentage of context used before recommending action
    # Default: 70% (manual-snapshots), 85% (compaction-aware)
    compact_at_percent: null

    # Max files read before suggesting fresh session
    # Default: 20 (manual-snapshots), 50 (compaction-aware)
    max_files_read: null

    # Max session duration before suggesting checkpoint
    # Default: "2h" (manual-snapshots), "4h" (compaction-aware)
    max_session_duration: null

    # Max messages before suggesting checkpoint
    # Default: 50 (manual-snapshots), 150 (compaction-aware)
    max_messages: null

  # Fork decision thresholds
  fork:
    # Files read threshold to trigger fork (selective mode)
    # Default: 30 (selective), 10 (aggressive)
    min_files_for_fork: null

    # Output lines threshold to trigger fork (selective mode)
    # Default: 500 (selective), 200 (aggressive)
    min_output_for_fork: null

# --- API Recommendations ---
# These settings CANNOT be controlled by the plugin directly.
# They are recommendations for whoever configures the API caller
# (Claude Code CLI, custom SDK integration, etc.)
#
# Document them here so the team knows the optimal API configuration
# for each workflow phase.

api_recommendations:
  # Effort levels per workflow phase (Opus 4.6+ adaptive thinking)
  effort_by_phase:
    route: medium       # Routing is classification, not deep analysis
    plan: max           # Planning benefits from maximum reasoning
    work: high          # Implementation needs solid reasoning
    review: max         # Reviews need thorough analysis
    compound: medium    # Learning capture is structured extraction
    research: medium    # Research agents balance breadth vs depth
    quick_check: low    # Token advisor, status checks

  # Speed mode recommendations (Opus 4.6+ fast mode)
  speed_by_task:
    research_agents: fast       # Read-heavy, benefit from speed
    code_review: standard       # Accuracy matters more than speed
    implementation: standard    # Correctness is critical
    quick_status: fast          # Rapid checks
    planning: standard          # Depth matters

  # Thinking mode
  thinking:
    opus_4_6: adaptive          # Recommended for Opus 4.6
    opus_4_5: enabled           # Standard extended thinking
    sonnet: enabled             # Standard extended thinking
    haiku: disabled             # Not needed for lightweight tasks
