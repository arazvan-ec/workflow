{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "architectural_constraint_spec.json",
  "title": "Architectural Constraint Specification",
  "description": "Schema for extracted architectural constraints and patterns from project code",
  "type": "object",
  "required": ["constraint_id", "name", "type", "last_extracted"],
  "properties": {
    "constraint_id": {
      "type": "string",
      "description": "Unique identifier (e.g., 'ARCH-001', 'LAYER-002')"
    },
    "name": {
      "type": "string",
      "description": "Short name for the constraint"
    },
    "description": {
      "type": "string",
      "description": "Full description of the architectural constraint"
    },
    "type": {
      "type": "string",
      "enum": [
        "layer_dependency",
        "naming_convention",
        "file_organization",
        "import_restriction",
        "pattern_enforcement",
        "module_boundary",
        "technology_constraint",
        "security_boundary"
      ],
      "description": "Type of architectural constraint"
    },
    "last_extracted": {
      "type": "string",
      "format": "date-time"
    },
    "confidence": {
      "type": "string",
      "pattern": "^[0-9]{1,3}%$"
    },
    "severity": {
      "type": "string",
      "enum": ["mandatory", "recommended", "optional"]
    },
    "scope": {
      "type": "object",
      "description": "Where this constraint applies",
      "properties": {
        "layers": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["domain", "application", "infrastructure", "presentation", "shared"]
          }
        },
        "modules": {
          "type": "array",
          "items": { "type": "string" }
        },
        "file_patterns": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Glob patterns for affected files"
        }
      }
    },
    "rule": {
      "type": "object",
      "description": "The actual constraint rule",
      "properties": {
        "must": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Things that MUST be done"
        },
        "must_not": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Things that MUST NOT be done"
        },
        "should": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Things that SHOULD be done (recommended)"
        },
        "may": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Things that MAY be done (optional)"
        }
      }
    },
    "layer_dependencies": {
      "type": "object",
      "description": "Allowed dependencies between layers",
      "properties": {
        "domain": {
          "type": "object",
          "properties": {
            "can_import": { "type": "array", "items": { "type": "string" } },
            "cannot_import": { "type": "array", "items": { "type": "string" } }
          }
        },
        "application": {
          "type": "object",
          "properties": {
            "can_import": { "type": "array", "items": { "type": "string" } },
            "cannot_import": { "type": "array", "items": { "type": "string" } }
          }
        },
        "infrastructure": {
          "type": "object",
          "properties": {
            "can_import": { "type": "array", "items": { "type": "string" } },
            "cannot_import": { "type": "array", "items": { "type": "string" } }
          }
        },
        "presentation": {
          "type": "object",
          "properties": {
            "can_import": { "type": "array", "items": { "type": "string" } },
            "cannot_import": { "type": "array", "items": { "type": "string" } }
          }
        }
      }
    },
    "naming_conventions": {
      "type": "object",
      "description": "Naming patterns enforced",
      "properties": {
        "files": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "pattern": { "type": "string" },
              "example": { "type": "string" }
            }
          }
        },
        "classes": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "pattern": { "type": "string" },
              "suffix": { "type": "string" },
              "prefix": { "type": "string" },
              "example": { "type": "string" }
            }
          }
        },
        "functions": {
          "type": "object"
        },
        "variables": {
          "type": "object"
        }
      }
    },
    "file_organization": {
      "type": "object",
      "description": "Expected file organization patterns",
      "properties": {
        "structure": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "path": { "type": "string" },
              "contains": { "type": "array", "items": { "type": "string" } },
              "purpose": { "type": "string" }
            }
          }
        }
      }
    },
    "patterns_required": {
      "type": "array",
      "description": "Design patterns that must be used",
      "items": {
        "type": "object",
        "properties": {
          "pattern": { "type": "string" },
          "where": { "type": "string" },
          "example": { "type": "string" }
        }
      }
    },
    "violations_found": {
      "type": "array",
      "description": "Current violations of this constraint (for drift detection)",
      "items": {
        "type": "object",
        "properties": {
          "file": { "type": "string" },
          "line": { "type": "integer" },
          "description": { "type": "string" },
          "severity": { "type": "string" }
        }
      }
    },
    "rationale": {
      "type": "string",
      "description": "Why this constraint exists"
    },
    "references": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Links to documentation or ADRs explaining this constraint"
    },
    "extracted_from": {
      "type": "array",
      "items": { "type": "string" }
    },
    "enforced_by": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Tools or configs that enforce this (eslint, phpstan, etc.)"
    }
  }
}
