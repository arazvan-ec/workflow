# Discovered Insights — Patterns the Agent Has Detected
# Version: 1.0.0
#
# This file captures patterns the agent discovers during compound capture
# and proposes to the user for review. This creates a bidirectional learning
# loop: the user teaches the agent (user-insights.yaml) and the agent
# discovers patterns and proposes them back (this file).
#
# Lifecycle:
#   1. Agent detects a pattern during /workflows:compound or /workflows:review
#   2. Agent records it here with status: pending_review
#   3. User reviews and either accepts, rejects, or modifies
#   4. Accepted insights become active and influence future decisions
#   5. Confidence adjusts with accumulated evidence
#
# Schema:
#   id:                   Unique identifier (kebab-case)
#   observation:          What the agent detected (described for human understanding)
#   confidence:           How confident the agent is (0.0 to 1.0)
#                         0.0-0.3 = weak signal, 0.4-0.6 = moderate, 0.7-1.0 = strong
#   evidence:             List of concrete evidence (commit refs, feature IDs, metrics)
#   detected_during:      Which feature/phase triggered the discovery
#   when_to_apply:        Suggested phases where this insight would help
#   suggested_influence:  Agent's suggested influence level (user can override)
#   status:               pending_review | accepted | rejected | promoted
#                         promoted = moved to user-insights.yaml as a first-class insight
#   user_notes:           User's comments when accepting/rejecting (empty until reviewed)
#   final_influence:      User-set influence (only after acceptance, overrides suggested)
#   detected_at:          Date of detection
#   reviewed_at:          Date of user review (empty until reviewed)

discovered: []

# ─────────────────────────────────────────────────────────────────────
# EXAMPLE (will be replaced by real discoveries)
# ─────────────────────────────────────────────────────────────────────

# - id: example-pattern
#   observation: >
#     In this project, endpoints that skip input validation at the controller
#     level produce 4x more bugs during review compared to validated ones.
#   confidence: 0.8
#   evidence:
#     - "feature: user-auth — 3 bugs from unvalidated POST /api/users"
#     - "feature: payments — 2 bugs from unvalidated POST /api/charges"
#   detected_during: "compound:payments"
#   when_to_apply: [implementation, review]
#   suggested_influence: high
#   status: pending_review
#   user_notes: ""
#   final_influence: null
#   detected_at: "2026-02-25"
#   reviewed_at: null

# ─────────────────────────────────────────────────────────────────────
# HOW DISCOVERIES ARE MADE
# ─────────────────────────────────────────────────────────────────────
#
# The agent detects patterns by analyzing:
#
# 1. COMPOUND PHASE (primary source):
#    - Anti-patterns that recur across 2+ features → high confidence
#    - Patterns that consistently reduce BCP iterations → medium confidence
#    - 70% boundary similarities across features → medium confidence
#    - Time calibration deviations (planning vs actual) → low confidence
#
# 2. REVIEW PHASE (secondary source):
#    - Rejection reasons that repeat across features
#    - SOLID violations that appear in the same architectural layer
#    - Test gaps that consistently appear in the same area
#
# 3. CROSS-FEATURE ANALYSIS:
#    - Comparing compound_log.md entries across features
#    - Comparing retrospective themes across features
#    - Detecting drift in architecture-profile.yaml patterns
#
# ─────────────────────────────────────────────────────────────────────
# CONFIDENCE CALIBRATION
# ─────────────────────────────────────────────────────────────────────
#
# Confidence increases when:
#   - Same pattern observed in 2+ features (+0.2 per feature)
#   - Pattern has measurable impact (metrics) (+0.1)
#   - Pattern confirmed by user acceptance (+0.1)
#
# Confidence decreases when:
#   - Counter-example found (-0.2)
#   - User rejects with explanation (-0.3)
#   - Pattern not observed in expected context (-0.1)
#
# ─────────────────────────────────────────────────────────────────────
# PROMOTION TO USER INSIGHTS
# ─────────────────────────────────────────────────────────────────────
#
# A discovered insight can be promoted to user-insights.yaml when:
#   - confidence >= 0.7
#   - status = accepted
#   - observed in 3+ features
#   - user explicitly promotes it via insights-manager skill
#
# Promoted insights are moved to user-insights.yaml with:
#   - The user-confirmed observation (may differ from agent's wording)
#   - The user-set influence level
#   - Full evidence chain preserved
#   - Origin marked as "discovered" (vs "user-contributed")
