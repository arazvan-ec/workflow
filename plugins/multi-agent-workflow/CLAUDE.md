# Multi-Agent Workflow Plugin

A compound engineering framework for coordinating multiple AI agents working in parallel on software development.

---

## ðŸš¨ MANDATORY: Workflow Routing (READ FIRST)

**CRITICAL RULE**: Every interaction with this plugin MUST pass through the workflow router.

### The Golden Rule

> **"No direct workflow execution without routing first. When in doubt, ASK."**

### Mandatory Entry Point

Before executing ANY task, Claude MUST:

1. **Analyze** the user's request
2. **Classify** the type of work (feature, bug, refactor, investigation, etc.)
3. **Assess** complexity and scope
4. **Ask clarifying questions** if confidence is < 60%
5. **Route** to the appropriate workflow

### Quick Routing Command

```bash
/workflows:route
```

### Self-Check Protocol (MUST run before ANY code change)

```markdown
## Router Verification Checklist

- [ ] Did this request pass through /workflows:route?
- [ ] Was the work type clearly identified?
- [ ] Were clarifying questions asked if needed?
- [ ] Is the chosen workflow appropriate for the task?
- [ ] Has trust level been considered for sensitive areas?

âš ï¸ If ANY checkbox is NO â†’ STOP and run /workflows:route first
```

### When to Ask Clarifying Questions

Ask questions when:
- The request is vague or ambiguous
- Multiple workflows could apply
- The scope is unclear
- Sensitive areas (auth, payments, security) may be touched
- The user says "just do it" without specifications

### Clarifying Question Templates

**For Features**:
- Â¿Puedes describir la funcionalidad en 2-3 oraciones?
- Â¿QuiÃ©n usarÃ¡ esta funcionalidad?
- Â¿Backend, frontend, o ambos?
- Â¿Se conecta con APIs externas?
- Â¿Maneja datos sensibles?

**For Bugs**:
- Â¿QuÃ© estÃ¡ pasando ahora vs quÃ© deberÃ­a pasar?
- Â¿CÃ³mo puedo reproducir el error?
- Â¿Siempre ocurre o es intermitente?
- Â¿Hay mensajes de error especÃ­ficos?

**For Refactoring**:
- Â¿QuÃ© archivos/mÃ³dulos estÃ¡n involucrados?
- Â¿Por quÃ© es necesario este cambio?
- Â¿Hay tests existentes?

### Workflow Selection Quick Guide

| User Need | Ask About | Then Route To |
|-----------|-----------|---------------|
| Nueva funcionalidad | Complejidad, stack, integraciones | `/workflows:plan` |
| Bug fix | Reproducibilidad, error messages | `bug-reproducer` â†’ `/workflows:work` |
| Refactoring | Alcance, motivaciÃ³n, tests | Depends on scope |
| InvestigaciÃ³n | QuÃ© necesita saber, dÃ³nde buscar | Research agents |
| Code review | QuÃ© revisar, preocupaciones | `/workflows:review` |

### Exception: Continuing Previous Work

The ONLY exception to mandatory routing is when:
- Continuing an already-routed task in the same session
- The workflow and next steps are already established in `50_state.md`

Even then, verify the context is still valid before proceeding.

---

## Philosophy

> **"Each unit of engineering work should make subsequent units easierâ€”not harder"**
> â€” Compound Engineering Principle

This plugin extends compound engineering with:

1. **Shared Technical Context**: Agents work with predefined rules (DDD, TDD, project conventions)
2. **Parallel Generation**: Code generated by multiple agents coordinated by roles or layers
3. **Quality Compounding**: Each feature captures learnings for future development

## Quick Start

```bash
# Install the plugin
/plugin marketplace add https://github.com/arazvan-ec/workflow
/plugin install multi-agent-workflow

# Plan a feature (80% of compound engineering)
/workflows:plan user-authentication

# Execute with specific mode
/workflows:work --mode=roles --role=backend user-authentication
/workflows:work --mode=layers --layer=domain user-authentication

# Review before merge
/workflows:review user-authentication

# Capture learnings (compound effect)
/workflows:compound user-authentication
```

## Core Workflows (4 Phases)

| Phase | Command | Purpose | Time |
|-------|---------|---------|------|
| **Plan** | `/workflows:plan` | Convert ideas into implementable strategies | 40% |
| **Work** | `/workflows:work` | Execute with worktrees and task management | 40% |
| **Review** | `/workflows:review` | Multi-agent review before merge | 15% |
| **Compound** | `/workflows:compound` | Capture insights for future work | 5% |

## Parallelization Modes

### By Role (Standard)
```
Planner â†’ Backend + Frontend â†’ QA
```
Best for: Full-stack features with separate concerns

### By Layer (DDD)
```
Domain + Application + Infrastructure (parallel)
```
Best for: Complex backend with business logic

### By Stack
```
Backend complete + Frontend complete (parallel)
```
Best for: Independent features or separate teams

## Agent Categories

| Category | Count | Purpose |
|----------|-------|---------|
| **Roles** | 4 | Core development roles (planner, backend, frontend, qa) |
| **Review** | 4 | Quality assurance (security, performance, DDD, code) |
| **Research** | 3 | Codebase analysis (analyzer, git history, dependencies) |
| **Workflow** | 3 | Automation (bug reproducer, spec analyzer, style enforcer) |
| **Design** | 2 | Architecture (API designer, UI verifier) |

## Multi-Agent Commands

| Command | Description |
|---------|-------------|
| `/workflows:route` | **MANDATORY** - Route requests to appropriate workflow (entry point) |
| `/workflows:role` | Work as a specific role on a feature |
| `/workflows:sync` | Synchronize state between agents |
| `/workflows:status` | View status of all roles |

## Skills

| Skill | Description |
|-------|-------------|
| **Core** | consultant, checkpoint, git-sync |
| **Quality** | test-runner, coverage-checker, lint-fixer |
| **Workflow** | worktree-manager, commit-formatter |
| **Compound** | changelog-generator, layer-validator |

## Key Patterns

### Ralph Wiggum Pattern (Auto-Correction Loop)
```
while tests_failing and iterations < 10:
    fix_code()
    run_tests()
    if passing: checkpoint_complete()

if iterations >= 10:
    mark_blocked()
    document_for_help()
```

### Compound Capture Pattern
After each feature:
1. Review commits and PRs
2. Identify patterns/anti-patterns
3. Update project rules automatically
4. Document in compound_log.md

### Context Management (Commodore 64)
- Treat context as limited resource
- Checkpoint frequently for session resumption
- Signal to restart: >20 files, >2 hours, >50 messages

## State Management

All roles communicate via `50_state.md`:

```markdown
## Backend Engineer
**Status**: IN_PROGRESS
**Checkpoint**: Domain layer complete
**Notes**: Working on Application layer
```

Status values: `PENDING`, `IN_PROGRESS`, `BLOCKED`, `WAITING_API`, `COMPLETED`, `APPROVED`, `REJECTED`

## Project Structure

The plugin separates **core framework** (immutable) from **project extensions** (customizable).

### Plugin Core (DO NOT MODIFY)

```
plugins/multi-agent-workflow/
â”œâ”€â”€ .claude-plugin/
â”‚   â””â”€â”€ plugin.json          # Plugin metadata
â”œâ”€â”€ core/                    # Framework core
â”‚   â”œâ”€â”€ rules/               # Framework rules (immutable)
â”‚   â”‚   â””â”€â”€ framework_rules.md
â”‚   â”œâ”€â”€ roles/               # Base role definitions
â”‚   â”‚   â”œâ”€â”€ planner.md
â”‚   â”‚   â”œâ”€â”€ backend.md
â”‚   â”‚   â”œâ”€â”€ frontend.md
â”‚   â”‚   â””â”€â”€ qa.md
â”‚   â”œâ”€â”€ schemas/             # JSON validation schemas
â”‚   â”‚   â”œâ”€â”€ feature_spec.json
â”‚   â”‚   â”œâ”€â”€ task_spec.json
â”‚   â”‚   â””â”€â”€ api_contract.json
â”‚   â”œâ”€â”€ templates/           # YAML templates
â”‚   â””â”€â”€ docs/                # Methodology docs
â”‚       â”œâ”€â”€ COMPREHENSION_DEBT.md
â”‚       â”œâ”€â”€ PAIRING_PATTERNS.md
â”‚       â””â”€â”€ GIT_WORKFLOW.md
â”œâ”€â”€ agents/                  # Specialized agents
â”‚   â”œâ”€â”€ review/              # 4 review agents
â”‚   â”œâ”€â”€ research/            # 3 research agents
â”‚   â”œâ”€â”€ workflow/            # 4 workflow agents
â”‚   â””â”€â”€ design/              # 2 design agents
â”œâ”€â”€ commands/
â”‚   â””â”€â”€ workflows/           # Executable commands
â”œâ”€â”€ skills/                  # Shared skills
â”œâ”€â”€ CLAUDE.md
â””â”€â”€ README.md
```

### Project Extensions (CUSTOMIZE HERE)

```
.ai/
â”œâ”€â”€ project/                 # Project specs
â”‚   â”œâ”€â”€ config.yaml          # Project configuration
â”‚   â”œâ”€â”€ context.md           # Project context
â”‚   â”œâ”€â”€ features/            # Feature specifications
â”‚   â”‚   â””â”€â”€ [feature-name]/
â”‚   â”‚       â”œâ”€â”€ FEATURE.md
â”‚   â”‚       â”œâ”€â”€ 50_state.md
â”‚   â”‚       â””â”€â”€ ...
â”‚   â””â”€â”€ sessions/            # Checkpoints
â””â”€â”€ extensions/              # Project extensions
    â”œâ”€â”€ rules/               # Project-specific rules
    â”‚   â”œâ”€â”€ project_rules.md # Stack, conventions
    â”‚   â””â”€â”€ ddd_rules.md     # DDD rules (if applicable)
    â”œâ”€â”€ workflows/           # Custom workflows
    â”‚   â”œâ”€â”€ default.yaml
    â”‚   â””â”€â”€ *.yaml
    â”œâ”€â”€ trust/               # Trust configuration
    â”‚   â””â”€â”€ trust_model.yaml
    â”œâ”€â”€ scripts/             # Utility scripts
    â”‚   â”œâ”€â”€ git/
    â”‚   â”œâ”€â”€ enforcement/
    â”‚   â”œâ”€â”€ harness/
    â”‚   â””â”€â”€ tools/
    â”œâ”€â”€ templates/           # Markdown templates
    â””â”€â”€ proposals/           # Workflow proposals
```

### Key Separation

| Component | Location | Modifiable |
|-----------|----------|------------|
| Framework Rules | `plugins/.../core/rules/` | NO |
| Project Rules | `.ai/extensions/rules/` | YES |
| Base Roles | `plugins/.../core/roles/` | NO |
| Workflows | `.ai/extensions/workflows/` | YES |
| Trust Model | `.ai/extensions/trust/` | YES |
| Features | `.ai/project/features/` | YES |
| Scripts | `.ai/extensions/scripts/` | YES |

## Best Practices

1. **Route First, Always**: Every request passes through `/workflows:route` before any work
2. **Ask When Unclear**: If confidence < 60%, ask clarifying questions before proceeding
3. **80% Planning, 20% Execution**: Invest in planning with `/workflows:plan`
4. **One role per session**: Don't switch roles mid-conversation
5. **Sync before work**: Always pull latest changes first
6. **TDD always**: Write tests before implementation
7. **Compound always**: Run `/workflows:compound` after each feature

## Integration

This plugin works best with:
- **Git**: For synchronization between agents
- **Tilix/tmux**: For running multiple roles in parallel
- **Symfony/React**: Optimized for this stack (but adaptable)
- **DDD Architecture**: Domain-Driven Design patterns

---

**Version**: 2.1.0
**Aligned with**: Compound Engineering principles
**Last updated**: 2026-01-28
**Changes**: Refactored structure to separate plugin core from project extensions
