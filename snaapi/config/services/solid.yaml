# config/services/solid.yaml
# SOLID Architecture Services Configuration
#
# This configuration follows SOLID principles:
# - SRP: Each service has a single responsibility
# - OCP: New implementations can be added without modifying existing code
# - LSP: Services are substitutable via interfaces
# - ISP: Clients depend on segregated interfaces
# - DIP: High-level modules depend on abstractions

services:
    _defaults:
        autowire: true
        autoconfigure: true

    # =================================================================
    # FORMATTERS (SRP - Single Responsibility Principle)
    # =================================================================

    # Date Formatter - Single responsibility: format dates
    App\Application\Service\Formatter\DateFormatterInterface:
        alias: App\Application\Service\Formatter\DateFormatter

    App\Application\Service\Formatter\DateFormatter: ~

    # Type Mapper - Single responsibility: map editorial types
    App\Application\Service\Formatter\TypeMapperInterface:
        alias: App\Application\Service\Formatter\TypeMapper

    App\Application\Service\Formatter\TypeMapper: ~

    # URL Formatter - Single responsibility: format URLs
    App\Application\Service\Formatter\UrlFormatterInterface:
        alias: App\Application\Service\Formatter\UrlFormatter

    App\Application\Service\Formatter\UrlFormatter:
        arguments:
            $baseUrl: '%env(APP_HOST)%'

    # =================================================================
    # STRATEGY PATTERN (OCP + LSP - Open/Closed + Liskov Substitution)
    # Editorial Field Extractors - eliminates method_exists() checks
    # =================================================================

    # Tag all field extractors for automatic collection
    _instanceof:
        App\Application\Strategy\Editorial\EditorialFieldExtractorInterface:
            tags: ['app.editorial_field_extractor']

    # Default extractor (fallback) - lowest priority
    App\Application\Strategy\Editorial\DefaultEditorialFieldExtractor: ~

    # Blog extractor - handles EditorialBlog-specific fields
    App\Application\Strategy\Editorial\BlogEditorialFieldExtractor: ~

    # Chain that orchestrates all extractors (Strategy + Chain of Responsibility)
    App\Application\Strategy\Editorial\EditorialFieldExtractorChain:
        arguments:
            $extractors: !tagged_iterator app.editorial_field_extractor

    # Bind the chain as the main implementation
    App\Application\Strategy\Editorial\EditorialFieldExtractorInterface:
        alias: App\Application\Strategy\Editorial\EditorialFieldExtractorChain

    # =================================================================
    # SPECIFICATION PATTERN (SRP - Single Responsibility)
    # Business rule specifications for validation
    # =================================================================

    App\Application\Specification\Editorial\EditorialIsPublishedSpecification: ~
    App\Application\Specification\Editorial\EditorialIsNotDeletedSpecification: ~
    App\Application\Specification\Editorial\EditorialIsIndexableSpecification: ~
    App\Application\Specification\Editorial\EditorialIsCommentableSpecification: ~
    App\Application\Specification\Editorial\EditorialIsAvailableSpecification: ~

    # =================================================================
    # SOLID FACTORIES (DIP - Dependency Inversion)
    # =================================================================

    App\Application\Factory\Response\SolidEditorialResponseFactory:
        arguments:
            $dateFormatter: '@App\Application\Service\Formatter\DateFormatterInterface'
            $typeMapper: '@App\Application\Service\Formatter\TypeMapperInterface'
            $fieldExtractor: '@App\Application\Strategy\Editorial\EditorialFieldExtractorInterface'

    # =================================================================
    # SOLID PIPELINE (OCP + DIP)
    # =================================================================

    App\Application\Pipeline\SolidEnrichmentPipeline:
        arguments:
            $enrichers: !tagged_iterator app.enricher

    # =================================================================
    # SOLID HANDLER (SRP + DIP)
    # =================================================================

    App\Application\Handler\SolidGetEditorialHandler: ~

    # =================================================================
    # VALUE OBJECTS (Immutable Domain Objects)
    # These are not services - just documenting they exist
    # =================================================================
    # App\Domain\ValueObject\EditorialId
    # App\Domain\ValueObject\EditorialType
    # App\Domain\ValueObject\PublicationDate
    # App\Domain\ValueObject\Url
    # App\Domain\ValueObject\WordCount

    # =================================================================
    # CONTEXT INTERFACES (ISP - Interface Segregation)
    # These are not services - they are contracts for type-hinting
    # =================================================================
    # App\Application\Contract\Context\HasEditorialInterface
    # App\Application\Contract\Context\HasSectionInterface
    # App\Application\Contract\Context\HasMultimediaInterface
    # App\Application\Contract\Context\HasTagsInterface
    # App\Application\Contract\Context\HasJournalistsInterface
    # App\Application\Contract\Context\HasCommentsInterface
    # App\Application\Contract\Context\HasMembershipInterface
    # App\Application\Contract\Context\ContextInterface

    # =================================================================
    # RESULT PATTERN (For consistent error handling)
    # These are not services - they are used inline
    # =================================================================
    # App\Application\Result\Result
    # App\Application\Result\Error
    # App\Application\Result\ResultCollection
