<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Development Dashboard - SNAAPI</title>
<style>
:root{--bg0:#0d1117;--bg1:#161b22;--bg2:#1c2128;--bg3:#262c36;--bd:#30363d;--bd2:#21262d;--t1:#e6edf3;--t2:#8b949e;--t3:#6e7681;--blue:#58a6ff;--green:#3fb950;--yellow:#d29922;--red:#f85149;--purple:#bc8cff;--cyan:#39d2c0;--orange:#db6d28;--r:8px;--rs:4px}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Helvetica,Arial,sans-serif;background:var(--bg0);color:var(--t1);line-height:1.5;font-size:14px}
.app{display:flex;min-height:100vh}
.sidebar{width:240px;background:var(--bg1);border-right:1px solid var(--bd);display:flex;flex-direction:column;position:fixed;top:0;left:0;height:100vh;z-index:10}
.sidebar-header{padding:20px 16px 12px;border-bottom:1px solid var(--bd)}
.logo{font-size:16px;font-weight:700;color:var(--blue);letter-spacing:-.5px}
.version{font-size:11px;color:var(--t3);display:block;margin-top:2px}
.nav-links{list-style:none;padding:8px 0;flex:1;overflow-y:auto}
.nav-link{display:flex;align-items:center;gap:10px;padding:8px 16px;color:var(--t2);text-decoration:none;font-size:13px;font-weight:500;cursor:pointer;border-left:3px solid transparent;transition:.2s}
.nav-link:hover{background:var(--bg3);color:var(--t1)}
.nav-link.active{color:var(--t1);background:var(--bg3);border-left-color:var(--blue)}
.ni{font-size:16px;width:20px;text-align:center}
.sidebar-footer{padding:12px 16px;border-top:1px solid var(--bd);font-size:11px;color:var(--t3)}
.content{flex:1;margin-left:240px;padding:24px 32px;min-height:100vh}
.ph{margin-bottom:24px}
.ph h2{font-size:22px;font-weight:600;margin-bottom:4px}
.ph p{color:var(--t2);font-size:13px}
.mg{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:24px}
.mc{background:var(--bg2);border:1px solid var(--bd);border-radius:var(--r);padding:20px;transition:.2s}
.mc:hover{border-color:var(--blue)}
.ml{font-size:12px;color:var(--t2);text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px}
.mv{font-size:28px;font-weight:700;line-height:1.2}
.ms{font-size:12px;color:var(--t3);margin-top:4px}
.card{background:var(--bg2);border:1px solid var(--bd);border-radius:var(--r);margin-bottom:16px;overflow:hidden}
.ch{padding:16px 20px;border-bottom:1px solid var(--bd2);display:flex;justify-content:space-between;align-items:center}
.ch h3{font-size:15px;font-weight:600}
.cb{padding:20px}
.fg{display:grid;grid-template-columns:repeat(auto-fill,minmax(380px,1fr));gap:16px;margin-bottom:24px}
.fc{background:var(--bg2);border:1px solid var(--bd);border-radius:var(--r);padding:20px;cursor:pointer;transition:.2s}
.fc:hover{border-color:var(--blue);transform:translateY(-1px);box-shadow:0 1px 3px rgba(0,0,0,.3)}
.fch{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px}
.fn{font-size:15px;font-weight:600}
.fw{font-size:11px;color:var(--t3);margin-top:2px}
.badge{display:inline-block;padding:2px 10px;border-radius:12px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.3px}
.b-pending{background:rgba(139,148,158,.15);color:var(--t2)}
.b-progress{background:rgba(88,166,255,.15);color:var(--blue)}
.b-completed{background:rgba(63,185,80,.15);color:var(--green)}
.b-blocked{background:rgba(248,81,73,.15);color:var(--red)}
.b-waiting{background:rgba(210,153,34,.15);color:var(--yellow)}
.pbc{margin-bottom:12px}
.pl{display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px}
.pln{color:var(--t2)}.plv{color:var(--t3);font-weight:600}
.pb{height:6px;background:var(--bg0);border-radius:3px;overflow:hidden}
.pf{height:100%;border-radius:3px;transition:width .5s}
.pf-blue{background:var(--blue)}.pf-green{background:var(--green)}.pf-yellow{background:var(--yellow)}.pf-red{background:var(--red)}.pf-purple{background:var(--purple)}
.rg{display:grid;grid-template-columns:repeat(4,1fr);gap:4px;margin-top:12px}
.rs{height:4px;border-radius:2px}
.rs-p{background:var(--t2);opacity:.3}.rs-i{background:var(--blue)}.rs-c{background:var(--green)}.rs-b{background:var(--red)}
table{width:100%;border-collapse:collapse}
th,td{padding:10px 16px;text-align:left;border-bottom:1px solid var(--bd2);font-size:13px}
th{color:var(--t2);font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:.5px;background:var(--bg1)}
tr:hover td{background:var(--bg3)}
.rdg{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;margin-bottom:24px}
.rc{background:var(--bg2);border:1px solid var(--bd);border-radius:var(--r);padding:16px}
.rch{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.rt{font-size:14px;font-weight:600;text-transform:capitalize}
.cp{width:56px;height:56px;position:relative}
.cp svg{transform:rotate(-90deg);width:56px;height:56px}
.cp .trk{fill:none;stroke:var(--bg0);stroke-width:4}
.cp .fl{fill:none;stroke-width:4;stroke-linecap:round}
.cp .vl{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:12px;font-weight:700}
.sc{background:var(--bg2);border:1px solid var(--bd);border-radius:var(--r);padding:16px;margin-bottom:12px;transition:.2s}
.sc:hover{border-color:var(--blue)}
.sh{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.ss{font-weight:600;font-size:14px;color:var(--blue)}
.sd{font-size:12px;color:var(--t3)}
.st{display:flex;gap:16px;flex-wrap:wrap;font-size:12px;color:var(--t2)}
.st strong{color:var(--t1);margin-right:4px}
.tbr{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.tbn{width:80px;font-size:11px;color:var(--t2);text-align:right;flex-shrink:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.tbt{flex:1;height:16px;background:var(--bg0);border-radius:var(--rs);overflow:hidden}
.tbf{height:100%;background:var(--blue);border-radius:var(--rs);min-width:2px}
.tbc{width:30px;font-size:11px;color:var(--t3);font-weight:600}
.ct{display:flex;gap:0;margin-bottom:24px;border-bottom:1px solid var(--bd)}
.ctb{padding:10px 20px;font-size:13px;font-weight:500;color:var(--t2);background:none;border:none;border-bottom:2px solid transparent;cursor:pointer;transition:.2s}
.ctb:hover{color:var(--t1)}.ctb.active{color:var(--blue);border-bottom-color:var(--blue)}
.cg{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:12px}
.ci{background:var(--bg2);border:1px solid var(--bd);border-radius:var(--r);padding:16px}
.cin{font-size:14px;font-weight:600;color:var(--blue);margin-bottom:4px}
.cic{font-size:11px;color:var(--t3);text-transform:uppercase;margin-bottom:8px}
.cid{font-size:13px;color:var(--t2);line-height:1.5;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical}
.tl{position:relative;padding-left:24px}
.tl::before{content:'';position:absolute;left:8px;top:0;bottom:0;width:2px;background:var(--bd)}
.ti{position:relative;margin-bottom:20px;padding-left:24px}
.td{position:absolute;left:-20px;top:4px;width:12px;height:12px;border-radius:50%;background:var(--blue);border:2px solid var(--bg0)}
.td-feat{background:var(--green)}.td-fix{background:var(--red)}.td-refactor{background:var(--purple)}.td-docs{background:var(--yellow)}.td-chore{background:var(--t3)}.td-cleanup{background:var(--orange)}
.tm{font-size:14px;font-weight:500;margin-bottom:4px}
.tmeta{display:flex;gap:12px;font-size:12px;color:var(--t3);flex-wrap:wrap}
.pr{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
.pc{padding:6px 12px;border-radius:var(--rs);font-size:12px;font-weight:500;border:1px solid var(--bd)}
.pc-c{background:rgba(63,185,80,.1);border-color:var(--green);color:var(--green)}
.pc-i{background:rgba(88,166,255,.1);border-color:var(--blue);color:var(--blue)}
.pc-p{background:rgba(139,148,158,.1);color:var(--t3)}
.bk{color:var(--blue);text-decoration:none;font-size:13px;display:inline-flex;align-items:center;gap:4px;margin-bottom:16px;cursor:pointer}
.bk:hover{text-decoration:underline}
.fdh{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid var(--bd)}
.fdt{font-size:22px;font-weight:700}
.fm{display:flex;gap:16px;margin-top:8px;flex-wrap:wrap;font-size:12px;color:var(--t2)}
.fm strong{color:var(--t1)}
.al{list-style:none;display:flex;flex-wrap:wrap;gap:8px}
.ai{background:var(--bg3);border:1px solid var(--bd);border-radius:var(--rs);padding:6px 12px;font-size:12px;color:var(--blue)}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
@media(max-width:768px){.sidebar{display:none}.content{margin-left:0;padding:16px}.mg{grid-template-columns:repeat(2,1fr)}.fg{grid-template-columns:1fr}.rdg{grid-template-columns:1fr}.g2{grid-template-columns:1fr}}
::-webkit-scrollbar{width:8px;height:8px}::-webkit-scrollbar-track{background:var(--bg0)}::-webkit-scrollbar-thumb{background:var(--bd);border-radius:4px}::-webkit-scrollbar-thumb:hover{background:var(--t3)}
code{background:var(--bg3);padding:1px 6px;border-radius:3px;font-size:12px;color:var(--yellow)}
/* Premium */
.pm-hero{text-align:center;padding:40px 20px 32px;background:linear-gradient(180deg,var(--bg1) 0%,var(--bg0) 100%);border:1px solid var(--bd);border-radius:var(--r);margin-bottom:24px;position:relative;overflow:hidden}
.pm-hero::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle at 30% 50%,rgba(88,166,255,.06) 0%,transparent 50%),radial-gradient(circle at 70% 50%,rgba(188,140,255,.06) 0%,transparent 50%);pointer-events:none}
.pm-badge{display:inline-block;padding:3px 12px;border-radius:16px;font-size:11px;font-weight:600;letter-spacing:.5px;background:rgba(88,166,255,.12);color:var(--blue);border:1px solid rgba(88,166,255,.25);margin-bottom:14px}
.pm-title{font-size:28px;font-weight:700;letter-spacing:-.5px;margin-bottom:8px;background:linear-gradient(135deg,var(--blue) 0%,var(--purple) 50%,var(--cyan) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.pm-desc{font-size:14px;color:var(--t2);max-width:560px;margin:0 auto 24px}
.pm-stats{display:flex;justify-content:center;gap:32px;flex-wrap:wrap}
.pm-stat-n{font-size:24px;font-weight:700;color:var(--t1)}
.pm-stat-l{font-size:11px;color:var(--t3);text-transform:uppercase;letter-spacing:.5px}
.pm-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px;margin-bottom:24px}
.pm-card{background:var(--bg2);border:1px solid var(--bd);border-radius:var(--r);padding:20px;transition:all .2s;position:relative;overflow:hidden}
.pm-card:hover{border-color:var(--blue);transform:translateY(-1px);box-shadow:0 4px 16px rgba(0,0,0,.3)}
.pm-card::after{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--blue),var(--purple),var(--cyan));opacity:0;transition:opacity .2s}
.pm-card:hover::after{opacity:1}
.pm-ico{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;margin-bottom:12px}
.pm-card h4{font-size:14px;font-weight:600;margin-bottom:6px}
.pm-card p{font-size:12px;color:var(--t2);line-height:1.5}
.pm-ver{display:inline-block;padding:1px 7px;border-radius:8px;font-size:10px;font-weight:600;background:rgba(63,185,80,.12);color:var(--green);margin-top:8px}
.pm-flow{background:var(--bg2);border:1px solid var(--bd);border-radius:var(--r);padding:24px;text-align:center;margin-bottom:24px}
.pm-flow-title{font-size:13px;font-weight:600;color:var(--t2);margin-bottom:16px;text-transform:uppercase;letter-spacing:.5px}
.pm-steps{display:flex;align-items:center;justify-content:center;gap:0;flex-wrap:wrap;padding:8px 0}
.pm-step{background:var(--bg3);border:1px solid var(--bd);border-radius:var(--rs);padding:10px 16px;text-align:center;min-width:90px}
.pm-step .sn{font-size:12px;font-weight:600;color:var(--t1)}
.pm-step .sw{font-size:10px;color:var(--t3)}
.pm-step.active{border-color:var(--blue);background:rgba(88,166,255,.08)}
.pm-arrow{color:var(--t3);font-size:16px;padding:0 3px;flex-shrink:0}
.pm-bcp{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:16px}
.pm-bcp-card{background:var(--bg2);border:1px solid var(--bd);border-radius:var(--r);padding:16px;text-align:center}
.pm-bcp-type{font-size:10px;text-transform:uppercase;letter-spacing:.5px;font-weight:600;margin-bottom:6px}
.pm-bcp-name{font-size:13px;font-weight:500;color:var(--t1)}
.pm-bcp-desc{font-size:11px;color:var(--t3);margin-top:4px}
.pm-bcp-num{font-size:22px;font-weight:700;margin:8px 0 2px}
.pm-agents{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:12px;margin-bottom:24px}
.pm-ag{background:var(--bg2);border:1px solid var(--bd);border-radius:var(--r);padding:14px}
.pm-ag-title{font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px;display:flex;align-items:center;gap:6px}
.pm-ag-count{font-size:10px;padding:1px 6px;border-radius:8px;font-weight:600}
.pm-ag-item{font-size:11px;color:var(--t2);padding:3px 0;display:flex;align-items:center;gap:6px}
.pm-ag-dot{width:5px;height:5px;border-radius:50%;flex-shrink:0}
.pm-cmp table{width:100%;border-collapse:collapse;font-size:12px}
.pm-cmp th,.pm-cmp td{padding:10px 14px;text-align:left;border-bottom:1px solid var(--bd2)}
.pm-cmp th{background:var(--bg1);color:var(--t2);font-size:10px;text-transform:uppercase;letter-spacing:.5px;font-weight:600}
.pm-cmp .c-no{color:var(--red)}.pm-cmp .c-yes{color:var(--green)}
.pm-cmp tr:hover td{background:var(--bg3)}
.pm-meth{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:10px;margin-bottom:24px}
.pm-meth-card{background:var(--bg2);border:1px solid var(--bd);border-radius:var(--r);padding:14px}
.pm-meth-card h4{font-size:13px;font-weight:600;margin-bottom:4px}
.pm-meth-card p{font-size:11px;color:var(--t2)}
.pm-compound{background:var(--bg2);border:1px solid var(--bd);border-radius:var(--r);padding:20px;margin-bottom:24px}
.pm-compound-title{font-size:14px;font-weight:600;margin-bottom:16px}
.pm-compound-bar{margin-bottom:12px}
.pm-compound-bar .lbl{font-size:12px;font-weight:500;color:var(--t1);margin-bottom:4px}
.pm-compound-bar .bar{height:8px;background:var(--bg0);border-radius:4px;overflow:hidden}
.pm-compound-bar .fill{height:100%;border-radius:4px}
.pm-compound-bar .sub{font-size:10px;color:var(--t3);margin-top:2px}
@media(max-width:768px){.pm-grid{grid-template-columns:1fr}.pm-bcp{grid-template-columns:1fr}.pm-agents{grid-template-columns:1fr 1fr}.pm-meth{grid-template-columns:1fr}}
/* Diff viewer */
.cm-row{border:1px solid var(--bd);border-radius:var(--r);margin-bottom:12px;background:var(--bg2);overflow:hidden;transition:.2s}
.cm-row:hover{border-color:var(--blue)}
.cm-hdr{padding:12px 16px;cursor:pointer;display:flex;align-items:center;gap:12px;user-select:none}
.cm-hdr:hover{background:var(--bg3)}
.cm-arr{color:var(--t3);font-size:12px;transition:transform .2s;flex-shrink:0}
.cm-arr.open{transform:rotate(90deg)}
.cm-msg{font-size:14px;font-weight:500;flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.cm-stats{display:flex;gap:8px;font-size:12px;flex-shrink:0}
.cm-st-f{color:var(--t2)}.cm-st-i{color:var(--green)}.cm-st-d{color:var(--red)}
.cm-body{border-top:1px solid var(--bd2);display:none}
.cm-body.open{display:block}
.cm-meta{padding:10px 16px;display:flex;gap:16px;font-size:12px;color:var(--t3);border-bottom:1px solid var(--bd2);flex-wrap:wrap}
.fl-list{padding:0}
.fl-item{display:flex;align-items:center;gap:10px;padding:6px 16px;font-size:13px;border-bottom:1px solid var(--bd2);font-family:'SFMono-Regular',Consolas,'Liberation Mono',Menlo,monospace}
.fl-item:last-child{border-bottom:none}
.fl-item:hover{background:var(--bg3)}
.fl-st{width:16px;height:16px;border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;flex-shrink:0}
.fl-st-A{background:rgba(63,185,80,.2);color:var(--green)}
.fl-st-M{background:rgba(88,166,255,.2);color:var(--blue)}
.fl-st-D{background:rgba(248,81,73,.2);color:var(--red)}
.fl-st-R{background:rgba(188,140,255,.2);color:var(--purple)}
.fl-path{flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:var(--t1)}
.fl-chg{display:flex;gap:4px;font-size:11px;flex-shrink:0}
.fl-chg-i{color:var(--green)}.fl-chg-d{color:var(--red)}
.fl-bar{display:flex;gap:1px;align-items:center;margin-left:4px}
.fl-bar span{width:6px;height:6px;border-radius:1px}
.fl-bar .bi{background:var(--green)}.fl-bar .bd{background:var(--red)}.fl-bar .be{background:var(--bg0)}
.diff-toggle{padding:8px 16px;border-top:1px solid var(--bd2);cursor:pointer;font-size:12px;color:var(--blue);font-weight:500;user-select:none}
.diff-toggle:hover{background:var(--bg3)}
.diff-wrap{display:none;max-height:600px;overflow:auto;background:var(--bg0)}
.diff-wrap.open{display:block}
.diff-ln{display:flex;font-family:'SFMono-Regular',Consolas,'Liberation Mono',Menlo,monospace;font-size:12px;line-height:1.6;min-width:fit-content}
.diff-ln:hover{filter:brightness(1.1)}
.diff-no{width:40px;text-align:right;padding:0 8px;color:var(--t3);user-select:none;flex-shrink:0;border-right:1px solid var(--bd2)}
.diff-tx{padding:0 12px;white-space:pre;flex:1;min-width:0}
.d-add{background:rgba(63,185,80,.1)}.d-add .diff-no{background:rgba(63,185,80,.06);color:var(--green)}
.d-del{background:rgba(248,81,73,.1)}.d-del .diff-no{background:rgba(248,81,73,.06);color:var(--red)}
.d-hunk{background:rgba(88,166,255,.08);color:var(--blue);font-style:italic}.d-hunk .diff-no{background:rgba(88,166,255,.04)}
.d-file{background:var(--bg1);color:var(--t2);font-weight:600}
</style>
</head>
<body>
<div class="app">
<nav class="sidebar">
<div class="sidebar-header">
<h1 class="logo">AI Dashboard</h1>
<span class="version">v3.0.0 - multi-agent-workflow</span>
</div>
<ul class="nav-links" id="nav">
<li><a class="nav-link active" data-page="overview" onclick="go('overview')"><span class="ni">&#9673;</span> Overview</a></li>
<li><a class="nav-link" data-page="features" onclick="go('features')"><span class="ni">&#9881;</span> Features</a></li>
<li><a class="nav-link" data-page="sessions" onclick="go('sessions')"><span class="ni">&#9201;</span> Sessions</a></li>
<li><a class="nav-link" data-page="quality" onclick="go('quality')"><span class="ni">&#10003;</span> Quality</a></li>
<li><a class="nav-link" data-page="plugin" onclick="go('plugin')"><span class="ni">&#9733;</span> Plugin Catalog</a></li>
<li><a class="nav-link" data-page="git" onclick="go('git')"><span class="ni">&#8644;</span> Git Timeline</a></li>
<li><a class="nav-link" data-page="premium" onclick="go('premium')"><span class="ni">&#9830;</span> Premium</a></li>
</ul>
<div class="sidebar-footer">Snapshot: 12 feb 2026 21:30</div>
</nav>
<main class="content" id="content"></main>
</div>

<!-- Data stored safely as non-executable JSON -->
<script type="application/json" id="dashboard-data">__DASHBOARD_DATA__</script>

<script>
// Parse data from the safe JSON block
var D = JSON.parse(document.getElementById('dashboard-data').textContent);

function go(page, arg) {
  document.querySelectorAll('.nav-link').forEach(function(l) {
    l.classList.remove('active');
    if (l.dataset.page === page || (page === 'feature-detail' && l.dataset.page === 'features')) l.classList.add('active');
  });
  var c = document.getElementById('content');
  try {
    if (page === 'overview') renderOverview(c);
    else if (page === 'features') renderFeatures(c);
    else if (page === 'feature-detail') renderFeatureDetail(c, arg);
    else if (page === 'sessions') renderSessions(c);
    else if (page === 'quality') renderQuality(c);
    else if (page === 'plugin') renderPlugin(c);
    else if (page === 'git') renderGit(c);
    else if (page === 'premium') renderPremium(c);
  } catch(e) {
    c.innerHTML = '<div style="padding:40px;color:var(--red)"><h3>Error rendering ' + page + '</h3><pre>' + e.message + '\n' + e.stack + '</pre></div>';
  }
}

function statusClass(s) {
  if (!s) return 'pending';
  var u = s.toUpperCase();
  if (u === 'COMPLETED' || u === 'APPROVED') return 'completed';
  if (u === 'IN_PROGRESS') return 'progress';
  if (u === 'BLOCKED') return 'blocked';
  if (u.indexOf('WAITING') >= 0 || u === 'READY_FOR_REVIEW') return 'waiting';
  return 'pending';
}

function progressColor(p) {
  return p >= 80 ? 'green' : p >= 40 ? 'blue' : p > 0 ? 'yellow' : 'blue';
}

function segClass(s) {
  if (!s) return 'rs-p';
  var u = s.toUpperCase();
  if (u === 'COMPLETED' || u === 'APPROVED') return 'rs-c';
  if (u === 'IN_PROGRESS') return 'rs-i';
  if (u === 'BLOCKED') return 'rs-b';
  return 'rs-p';
}

function fmtDate(d) {
  if (!d) return '';
  try { return new Date(d).toLocaleDateString('es-ES', {day:'2-digit', month:'short', year:'numeric'}); } catch(e) { return d; }
}

function fmtDateFull(d) {
  if (!d) return '';
  try { return new Date(d).toLocaleDateString('es-ES', {day:'2-digit', month:'short', year:'numeric', hour:'2-digit', minute:'2-digit'}); } catch(e) { return d; }
}

function fmtDur(s) {
  if (!s) return '-';
  if (s < 60) return s + 's';
  var m = Math.floor(s / 60), r = s % 60;
  if (m < 60) return m + 'm ' + r + 's';
  return Math.floor(m / 60) + 'h ' + (m % 60) + 'm';
}

function fmtTok(n) {
  if (!n) return '0';
  if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M';
  if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K';
  return n.toString();
}

function esc(t) {
  if (!t) return '';
  var d = document.createElement('div');
  d.textContent = String(t);
  return d.innerHTML;
}

var circ = 2 * Math.PI * 22;

function renderOverview(c) {
  var o = D.overview, p = o.project, fs = o.features_summary, ps = o.plugin_stats;
  c.innerHTML =
    '<div class="ph"><h2>' + esc(p.name) + ' Dashboard</h2><p>' + esc(p.description) + '</p></div>' +
    '<div class="mg">' +
      '<div class="mc"><div class="ml">Total Features</div><div class="mv" style="color:var(--blue)">' + fs.total + '</div><div class="ms">Plugin v' + esc(p.plugin_version) + '</div></div>' +
      '<div class="mc"><div class="ml">Completed</div><div class="mv" style="color:var(--green)">' + fs.completed + '</div><div class="ms">of ' + fs.total + ' features</div></div>' +
      '<div class="mc"><div class="ml">In Progress</div><div class="mv" style="color:var(--yellow)">' + fs.in_progress + '</div><div class="ms">' + fs.blocked + ' blocked</div></div>' +
      '<div class="mc"><div class="ml">Overall Progress</div><div class="mv" style="color:var(--purple)">' + fs.overall_progress_pct + '%</div><div class="ms">across all features</div></div>' +
      '<div class="mc"><div class="ml">Agents</div><div class="mv" style="color:var(--blue)">' + ps.agents + '</div><div class="ms">specialized agents</div></div>' +
      '<div class="mc"><div class="ml">Skills + Commands</div><div class="mv" style="color:var(--green)">' + (ps.skills + ps.commands) + '</div><div class="ms">' + ps.skills + ' skills, ' + ps.commands + ' commands</div></div>' +
    '</div>' +
    '<div class="fg">' + o.features.map(featureCard).join('') + '</div>' +
    '<div class="g2">' +
      '<div class="card"><div class="ch"><h3>Recent Commits</h3></div><div class="cb">' +
        o.recent_commits.map(function(cm) {
          return '<div style="padding:8px 0;border-bottom:1px solid var(--bd2);font-size:13px"><code>' + esc(cm.short_hash) + '</code> ' + esc(cm.message).substring(0, 55) + (cm.message.length > 55 ? '...' : '') + '<div style="font-size:11px;color:var(--t3);margin-top:2px">' + esc(cm.author) + ' - ' + fmtDate(cm.date) + '</div></div>';
        }).join('') +
      '</div></div>' +
      '<div class="card"><div class="ch"><h3>Recent Sessions</h3></div><div class="cb">' +
        o.recent_sessions.slice(0, 5).map(function(s) {
          return '<div style="padding:8px 0;border-bottom:1px solid var(--bd2);font-size:13px"><span style="color:var(--blue);font-weight:500">' + esc(s.slug || s.session_id.substring(0, 8)) + '</span> <span style="color:var(--t2)">' + s.message_count + ' msgs</span><div style="font-size:11px;color:var(--t3);margin-top:2px">' + esc(s.model || '?') + ' - ' + fmtDate(s.started_at) + '</div></div>';
        }).join('') +
      '</div></div>' +
    '</div>';
}

function featureCard(f) {
  var r = f.roles || {};
  var roles = ['planner', 'backend', 'frontend', 'qa'];
  return '<div class="fc" onclick="go(\'feature-detail\',\'' + esc(f.id) + '\')">' +
    '<div class="fch"><div><div class="fn">' + esc(f.name || f.id) + '</div><div class="fw">' + esc(f.workflow || 'default') + '</div></div><span class="badge b-' + statusClass(f.overall_status) + '">' + esc(f.overall_status) + '</span></div>' +
    '<div class="pbc"><div class="pl"><span class="pln">Overall</span><span class="plv">' + f.overall_progress_pct + '%</span></div><div class="pb"><div class="pf pf-' + progressColor(f.overall_progress_pct) + '" style="width:' + f.overall_progress_pct + '%"></div></div></div>' +
    '<div class="rg">' + roles.map(function(k) { var rl = r[k]; return '<div class="rs ' + (rl ? segClass(rl.status) : 'rs-p') + '" title="' + k + ': ' + (rl ? rl.status + ' (' + rl.progress_pct + '%)' : 'N/A') + '"></div>'; }).join('') + '</div>' +
    '<div style="display:flex;gap:16px;margin-top:12px;font-size:11px;color:var(--t3)">' + roles.map(function(k) { var rl = r[k]; return '<span>' + k.charAt(0).toUpperCase() + k.slice(1) + ': ' + (rl ? rl.progress_pct + '%' : '-') + '</span>'; }).join('') + '</div>' +
  '</div>';
}

function renderFeatures(c) {
  var features = D.overview.features;
  c.innerHTML = '<div class="ph"><h2>Features</h2><p>' + features.length + ' features tracked</p></div><div class="fg">' + features.map(featureCard).join('') + '</div>';
}

function renderFeatureDetail(c, fid) {
  var f = D.features_detail[fid];
  if (!f) { c.innerHTML = '<div style="text-align:center;padding:48px;color:var(--t2)">Feature not found</div>'; return; }
  var tasks = D.tasks[fid] || [];
  var roles = f.roles || {};
  var roleKeys = ['planner', 'backend', 'frontend', 'qa'];
  var html = '<a class="bk" onclick="go(\'features\')">&larr; Back to Features</a>' +
    '<div class="fdh"><div><div class="fdt">' + esc(f.name || f.id) + '</div><div class="fm"><span>Workflow: <strong>' + esc(f.workflow) + '</strong></span><span>Created: <strong>' + (f.created || '-') + '</strong></span><span>Updated: <strong>' + (f.last_updated || '-') + '</strong></span></div></div>' +
    '<div style="text-align:right"><span class="badge b-' + statusClass(f.overall_status) + '" style="font-size:13px;padding:4px 14px">' + esc(f.overall_status) + '</span><div style="font-size:24px;font-weight:700;margin-top:8px;color:var(--blue)">' + f.overall_progress_pct + '%</div></div></div>';

  html += '<div class="card" style="margin-bottom:24px"><div class="cb">' + roleKeys.map(function(k) {
    var r = roles[k]; if (!r) return '';
    return '<div class="pbc"><div class="pl"><span class="pln" style="text-transform:capitalize">' + k + '</span><span class="plv">' + r.progress_pct + '% (' + r.checkpoints_done + '/' + r.checkpoints_total + ')</span></div><div class="pb"><div class="pf pf-' + progressColor(r.progress_pct) + '" style="width:' + r.progress_pct + '%"></div></div></div>';
  }).join('') + '</div></div>';

  html += '<h3 style="margin-bottom:16px;font-size:16px">Role Progress</h3><div class="rdg">' + roleKeys.map(function(k) {
    var r = roles[k]; if (!r) return '';
    var off = circ - (r.progress_pct / 100) * circ;
    var col = r.status === 'COMPLETED' ? 'var(--green)' : r.status === 'BLOCKED' ? 'var(--red)' : 'var(--blue)';
    return '<div class="rc"><div class="rch"><div><div class="rt">' + esc(r.role) + '</div><span class="badge b-' + statusClass(r.status) + '" style="margin-top:4px">' + esc(r.status) + '</span></div>' +
      '<div class="cp"><svg viewBox="0 0 48 48"><circle class="trk" cx="24" cy="24" r="22"/><circle class="fl" cx="24" cy="24" r="22" stroke="' + col + '" stroke-dasharray="' + circ + '" stroke-dashoffset="' + off + '"/></svg><div class="vl">' + Math.round(r.progress_pct) + '%</div></div></div>' +
      (r.current_task ? '<div style="font-size:12px;color:var(--yellow);margin-bottom:8px">Current: ' + esc(r.current_task) + '</div>' : '') +
      (r.depends_on && r.depends_on.length ? '<div style="font-size:11px;color:var(--t3);margin-bottom:8px">Depends on: ' + r.depends_on.join(', ') + '</div>' : '') +
      (r.notes && r.notes.length ? '<div style="font-size:12px;color:var(--t2);margin-bottom:8px">' + r.notes.map(function(n) { return '<div style="margin-bottom:2px">- ' + esc(n) + '</div>'; }).join('') + '</div>' : '') +
      (r.completed_tasks && r.completed_tasks.length ? '<div style="font-size:11px;color:var(--t3);margin-top:8px">' + r.completed_tasks.length + ' tasks completed</div>' : '') +
      (r.blockers && r.blockers.length ? '<div style="font-size:12px;color:var(--red);margin-top:8px">Blockers: ' + r.blockers.join('; ') + '</div>' : '') +
    '</div>';
  }).join('') + '</div>';

  if (f.phases && f.phases.length) {
    html += '<div class="card"><div class="ch"><h3>Phase Progress</h3></div><div class="cb">' +
      '<div class="pr">' + f.phases.map(function(p) { var cls = p.status.toUpperCase().indexOf('COMPLETED') >= 0 ? 'pc-c' : p.status.toUpperCase().indexOf('PROGRESS') >= 0 ? 'pc-i' : 'pc-p'; return '<div class="pc ' + cls + '">' + esc(p.name) + ' (' + p.progress_pct + '%)</div>'; }).join('') + '</div>' +
      '<table><thead><tr><th>Phase</th><th>Status</th><th>Progress</th></tr></thead><tbody>' + f.phases.map(function(p) { return '<tr><td>' + esc(p.name) + '</td><td><span class="badge b-' + statusClass(p.status) + '">' + esc(p.status) + '</span></td><td>' + p.progress_pct + '%</td></tr>'; }).join('') + '</tbody></table></div></div>';
  }

  if (tasks.length) {
    var done = tasks.filter(function(t) { return t.done; }).length;
    html += '<div class="card"><div class="ch"><h3>Tasks (' + done + '/' + tasks.length + ' done)</h3></div><div class="cb">' +
      '<table><thead><tr><th>ID</th><th>Title</th><th>Status</th><th>Priority</th></tr></thead><tbody>' + tasks.map(function(t) { return '<tr><td><code>' + esc(t.id) + '</code></td><td>' + esc(t.title) + '</td><td>' + (t.done ? '<span class="badge b-completed">Done</span>' : '<span class="badge b-pending">Pending</span>') + '</td><td>' + (t.priority || '-') + '</td></tr>'; }).join('') + '</tbody></table></div></div>';
  }

  if (f.decisions && f.decisions.length) {
    html += '<div class="card"><div class="ch"><h3>Decisions</h3></div><div class="cb"><table><thead><tr><th>Date</th><th>Decision</th><th>Rationale</th></tr></thead><tbody>' + f.decisions.map(function(d) { return '<tr><td style="white-space:nowrap;color:var(--t3)">' + esc(d.date) + '</td><td>' + esc(d.decision) + '</td><td style="color:var(--t2)">' + esc(d.rationale) + '</td></tr>'; }).join('') + '</tbody></table></div></div>';
  }

  if (f.artifacts && f.artifacts.length) {
    html += '<div class="card"><div class="ch"><h3>Artifacts (' + f.artifacts.length + ')</h3></div><div class="cb"><ul class="al">' + f.artifacts.map(function(a) { return '<li class="ai">' + esc(a) + '</li>'; }).join('') + '</ul></div></div>';
  }
  c.innerHTML = html;
}

function renderSessions(c) {
  var sessions = D.sessions;
  var totalMsg = sessions.reduce(function(s, x) { return s + x.message_count; }, 0);
  var totalIn = sessions.reduce(function(s, x) { return s + (x.total_input_tokens || 0); }, 0);
  var totalOut = sessions.reduce(function(s, x) { return s + (x.total_output_tokens || 0); }, 0);
  c.innerHTML = '<div class="ph"><h2>Sessions</h2><p>' + sessions.length + ' sessions tracked</p></div>' +
    '<div class="mg">' +
      '<div class="mc"><div class="ml">Total Sessions</div><div class="mv" style="color:var(--blue)">' + sessions.length + '</div></div>' +
      '<div class="mc"><div class="ml">Total Messages</div><div class="mv" style="color:var(--green)">' + totalMsg.toLocaleString() + '</div></div>' +
      '<div class="mc"><div class="ml">Input Tokens</div><div class="mv" style="color:var(--yellow)">' + fmtTok(totalIn) + '</div></div>' +
      '<div class="mc"><div class="ml">Output Tokens</div><div class="mv" style="color:var(--purple)">' + fmtTok(totalOut) + '</div></div>' +
    '</div>' +
    sessions.map(function(s) {
      var maxTc = s.tool_calls.length ? Math.max.apply(null, s.tool_calls.map(function(t) { return t.count; })) : 1;
      return '<div class="sc"><div class="sh"><div><div class="ss">' + esc(s.slug || s.session_id.substring(0, 12)) + '</div><div style="font-size:11px;color:var(--t3);margin-top:2px">ID: ' + s.session_id.substring(0, 8) + '...</div></div><div class="sd">' + fmtDateFull(s.started_at) + '</div></div>' +
        '<div class="st"><div><strong>' + s.message_count + '</strong> messages</div><div><strong>' + s.user_message_count + '</strong> user</div><div><strong>' + s.assistant_message_count + '</strong> assistant</div><div><strong>' + fmtDur(s.duration_seconds) + '</strong> duration</div>' + (s.model ? '<div><strong>' + esc(s.model) + '</strong></div>' : '') + (s.git_branch ? '<div>Branch: <strong>' + esc(s.git_branch) + '</strong></div>' : '') + (s.permission_mode ? '<div>Mode: <strong>' + esc(s.permission_mode) + '</strong></div>' : '') + '</div>' +
        (s.total_input_tokens || s.total_output_tokens ? '<div style="margin-top:8px;font-size:12px;color:var(--t3)">Tokens: ' + fmtTok(s.total_input_tokens) + ' in / ' + fmtTok(s.total_output_tokens) + ' out</div>' : '') +
        (s.tool_calls.length ? '<div style="display:flex;flex-direction:column;gap:6px;margin-top:12px">' + s.tool_calls.slice(0, 8).map(function(tc) { return '<div class="tbr"><div class="tbn">' + esc(tc.tool) + '</div><div class="tbt"><div class="tbf" style="width:' + (tc.count / maxTc * 100) + '%"></div></div><div class="tbc">' + tc.count + '</div></div>'; }).join('') + '</div>' : '') +
      '</div>';
    }).join('');
}

function renderQuality(c) {
  var features = D.quality.features;
  c.innerHTML = '<div class="ph"><h2>Quality Metrics</h2><p>Code quality and coverage across all features</p></div>' +
    features.map(function(f) {
      var roles = f.roles || {}; var roleKeys = Object.keys(roles);
      return '<div class="card"><div class="ch"><h3>' + esc(f.feature_name || f.feature_id) + '</h3></div><div class="cb">' +
        '<table><thead><tr><th>Role</th><th>Completion</th><th>Coverage</th><th>Blockers</th></tr></thead><tbody>' +
        roleKeys.map(function(k) { var r = roles[k]; return '<tr><td style="text-transform:capitalize;font-weight:500">' + k + '</td><td><div class="pb" style="width:120px;display:inline-block;vertical-align:middle"><div class="pf pf-' + progressColor(r.completed_pct) + '" style="width:' + r.completed_pct + '%"></div></div> <span style="margin-left:8px;font-size:12px">' + r.completed_pct + '%</span></td><td>' + (r.coverage_lines && r.coverage_lines !== '-%' ? esc(r.coverage_lines) : '<span style="color:var(--t3)">-</span>') + '</td><td>' + (r.blockers && r.blockers.length ? '<span style="color:var(--red)">' + r.blockers.length + '</span>' : '<span style="color:var(--green)">0</span>') + '</td></tr>'; }).join('') +
        '</tbody></table></div></div>';
    }).join('');
}

function renderPlugin(c) {
  var agents = D.agents, skills = D.skills, commands = D.commands, info = D.plugin_info;
  c.innerHTML = '<div class="ph"><h2>Plugin Catalog</h2><p>' + esc(info.name) + ' v' + esc(info.version) + ' - ' + agents.length + ' agents, ' + skills.length + ' skills, ' + commands.length + ' commands</p></div>' +
    '<div class="ct"><button class="ctb active" onclick="showTab(this,\'agents\')">Agents (' + agents.length + ')</button><button class="ctb" onclick="showTab(this,\'skills\')">Skills (' + skills.length + ')</button><button class="ctb" onclick="showTab(this,\'commands\')">Commands (' + commands.length + ')</button></div>' +
    '<div id="tab-content">' + agentsGrid() + '</div>';

  window.showTab = function(btn, tab) {
    document.querySelectorAll('.ctb').forEach(function(b) { b.classList.remove('active'); }); btn.classList.add('active');
    var tc = document.getElementById('tab-content');
    if (tab === 'agents') tc.innerHTML = agentsGrid();
    else if (tab === 'skills') tc.innerHTML = skillsGrid();
    else tc.innerHTML = commandsGrid();
  };

  function agentsGrid() {
    var groups = {};
    agents.forEach(function(a) { var cat = a.category || 'other'; if (!groups[cat]) groups[cat] = []; groups[cat].push(a); });
    return Object.keys(groups).map(function(cat) {
      return '<h4 style="margin:16px 0 8px;font-size:13px;text-transform:uppercase;color:var(--t3);letter-spacing:.5px">' + esc(cat) + '</h4><div class="cg">' + groups[cat].map(function(a) { return '<div class="ci"><div class="cin">' + esc(a.name) + '</div><div class="cic">' + esc(a.category) + '</div><div class="cid">' + esc((a.description || 'No description').replace(/<[^>]*>/g, '')) + '</div></div>'; }).join('') + '</div>';
    }).join('');
  }

  function skillsGrid() {
    return '<div class="cg" style="margin-top:16px">' + skills.map(function(s) { return '<div class="ci"><div class="cin">' + esc(s.name) + '</div><div class="cid">' + esc((s.description || 'No description').replace(/<[^>]*>/g, '')) + '</div></div>'; }).join('') + '</div>';
  }

  function commandsGrid() {
    return '<div class="cg" style="margin-top:16px">' + commands.map(function(cm) { return '<div class="ci"><div class="cin">/workflows:' + esc(cm.name) + '</div>' + (cm.argument_hint ? '<div class="cic">' + esc(cm.argument_hint) + '</div>' : '') + '<div class="cid">' + esc((cm.description || 'No description').replace(/<[^>]*>/g, '')) + '</div></div>'; }).join('') + '</div>';
  }
}

function fileBar(ins, dels) {
  var total = ins + dels;
  if (total === 0) return '';
  var max = 5, scale = total > max ? max / total : 1;
  var gi = Math.round(ins * scale) || (ins > 0 ? 1 : 0);
  var rd = Math.round(dels * scale) || (dels > 0 ? 1 : 0);
  var empty = max - gi - rd;
  var h = '<span class="fl-bar">';
  for (var i = 0; i < gi; i++) h += '<span class="bi"></span>';
  for (var j = 0; j < rd; j++) h += '<span class="bd"></span>';
  for (var k = 0; k < empty; k++) h += '<span class="be"></span>';
  return h + '</span>';
}

function renderDiff(raw) {
  if (!raw) return '<div style="padding:16px;color:var(--t3);font-size:12px">No diff available</div>';
  var lines = raw.split('\n');
  var html = '';
  var ln = 0;
  for (var i = 0; i < lines.length; i++) {
    var l = lines[i];
    var cls = '', num = '';
    if (l.indexOf('diff --git') === 0) {
      cls = 'd-file'; num = ''; ln = 0;
    } else if (l.indexOf('@@') === 0) {
      cls = 'd-hunk'; num = '...';
      var m = l.match(/@@ -\d+(?:,\d+)? \+(\d+)/);
      if (m) ln = parseInt(m[1]) - 1;
    } else if (l.indexOf('---') === 0 || l.indexOf('+++') === 0 || l.indexOf('index ') === 0) {
      cls = 'd-file'; num = '';
    } else if (l.charAt(0) === '+') {
      cls = 'd-add'; ln++; num = ln;
    } else if (l.charAt(0) === '-') {
      cls = 'd-del'; num = '';
    } else {
      ln++; num = ln;
    }
    html += '<div class="diff-ln ' + cls + '"><div class="diff-no">' + num + '</div><div class="diff-tx">' + esc(l) + '</div></div>';
  }
  return html;
}

function toggleCommit(id) {
  var body = document.getElementById('cm-body-' + id);
  var arr = document.getElementById('cm-arr-' + id);
  if (body) { body.classList.toggle('open'); }
  if (arr) { arr.classList.toggle('open'); }
}

function toggleDiff(id) {
  var wrap = document.getElementById('diff-' + id);
  var btn = document.getElementById('diff-btn-' + id);
  if (wrap) {
    var open = wrap.classList.toggle('open');
    if (btn) btn.textContent = open ? '\u25BC Hide diff' : '\u25B6 Show diff';
  }
}

function renderGit(c) {
  var commits = D.commits, branches = D.branches;
  var totalIns = commits.reduce(function(s, cm) { return s + (cm.insertions || 0); }, 0);
  var totalDels = commits.reduce(function(s, cm) { return s + (cm.deletions || 0); }, 0);
  var totalFiles = commits.reduce(function(s, cm) { return s + (cm.files_changed || 0); }, 0);

  c.innerHTML = '<div class="ph"><h2>Git Timeline</h2><p>' + commits.length + ' recent commits across ' + branches.length + ' branches</p></div>' +
    '<div class="mg">' +
      '<div class="mc"><div class="ml">Commits</div><div class="mv" style="color:var(--blue)">' + commits.length + '</div></div>' +
      '<div class="mc"><div class="ml">Branches</div><div class="mv" style="color:var(--green)">' + branches.length + '</div></div>' +
      '<div class="mc"><div class="ml">Lines Added</div><div class="mv" style="color:var(--green)">+' + totalIns.toLocaleString() + '</div><div class="ms">across ' + totalFiles + ' files</div></div>' +
      '<div class="mc"><div class="ml">Lines Removed</div><div class="mv" style="color:var(--red)">-' + totalDels.toLocaleString() + '</div></div>' +
    '</div>' +
    commits.map(function(cm, idx) {
      var m = cm.message.toLowerCase();
      var type = m.indexOf('feat') === 0 || m.indexOf('add') === 0 ? 'feat' : m.indexOf('fix') === 0 ? 'fix' : m.indexOf('refactor') === 0 ? 'refactor' : m.indexOf('doc') === 0 ? 'docs' : m.indexOf('chore') === 0 ? 'chore' : m.indexOf('clean') === 0 ? 'cleanup' : '';
      var dotColor = type === 'feat' ? 'var(--green)' : type === 'fix' ? 'var(--red)' : type === 'refactor' ? 'var(--purple)' : type === 'docs' ? 'var(--yellow)' : type === 'chore' ? 'var(--t3)' : type === 'cleanup' ? 'var(--orange)' : 'var(--blue)';
      var files = cm.files || [];
      var hasDiff = cm.diff && cm.diff.length > 0;

      return '<div class="cm-row">' +
        '<div class="cm-hdr" onclick="toggleCommit(' + idx + ')">' +
          '<span id="cm-arr-' + idx + '" class="cm-arr">\u25B6</span>' +
          '<span style="width:10px;height:10px;border-radius:50%;background:' + dotColor + ';flex-shrink:0"></span>' +
          '<span class="cm-msg">' + esc(cm.message) + '</span>' +
          '<div class="cm-stats">' +
            (cm.files_changed ? '<span class="cm-st-f">' + cm.files_changed + ' files</span>' : '') +
            (cm.insertions ? '<span class="cm-st-i">+' + cm.insertions + '</span>' : '') +
            (cm.deletions ? '<span class="cm-st-d">-' + cm.deletions + '</span>' : '') +
          '</div>' +
          '<code style="font-size:11px;flex-shrink:0">' + esc(cm.short_hash) + '</code>' +
        '</div>' +
        '<div id="cm-body-' + idx + '" class="cm-body">' +
          '<div class="cm-meta">' +
            '<span>Author: <strong style="color:var(--t1)">' + esc(cm.author) + '</strong></span>' +
            '<span>Date: <strong style="color:var(--t1)">' + fmtDateFull(cm.date) + '</strong></span>' +
            '<span>Hash: <code>' + esc(cm.hash ? cm.hash.substring(0, 12) : cm.short_hash) + '</code></span>' +
          '</div>' +
          (files.length ? '<div class="fl-list">' + files.map(function(f) {
            return '<div class="fl-item">' +
              '<span class="fl-st fl-st-' + f.status + '">' + f.status + '</span>' +
              '<span class="fl-path">' + esc(f.path) + '</span>' +
              '<span class="fl-chg">' +
                (f.insertions ? '<span class="fl-chg-i">+' + f.insertions + '</span>' : '') +
                (f.deletions ? '<span class="fl-chg-d">-' + f.deletions + '</span>' : '') +
                fileBar(f.insertions, f.deletions) +
              '</span>' +
            '</div>';
          }).join('') + '</div>' : '') +
          (hasDiff ? '<div id="diff-btn-' + idx + '" class="diff-toggle" onclick="toggleDiff(' + idx + ')">\u25B6 Show diff</div><div id="diff-' + idx + '" class="diff-wrap">' + renderDiff(cm.diff) + '</div>' : '') +
        '</div>' +
      '</div>';
    }).join('');
}

function renderPremium(c) {
  var ps = D.overview.plugin_stats || {};
  var nAgents = ps.agents || 11, nSkills = ps.skills || 14, nCommands = ps.commands || 15;

  var features = [
    {icon:'&#9673;', bg:'rgba(88,166,255,.15)', color:'var(--blue)', title:'Dashboard en Tiempo Real', desc:'Visualizacion live del progreso con FastAPI, WebSocket y timeline de Git con diffs de codigo. Preview HTML standalone incluido.', ver:'v3.0.0'},
    {icon:'&#8635;', bg:'rgba(248,81,73,.15)', color:'var(--red)', title:'Bounded Correction Protocol', desc:'Loop acotado con 3 tipos de desviacion (GSD) y limites adaptativos (BMAD). Solution validation, goal-backward verification y adversarial self-review.', ver:'v2.10.0'},
    {icon:'&#9881;', bg:'rgba(188,140,255,.15)', color:'var(--purple)', title:nAgents + ' Agentes Especializados', desc:'Roles, review, research, workflow y design. Invocacion automatica desde los comandos del core flow. Equipos coordinados por categoria.', ver:'v3.0.0'},
    {icon:'&#9670;', bg:'rgba(210,153,34,.15)', color:'var(--yellow)', title:'Shape Up Methodology', desc:'Fase pre-planning con shapes, fit checks, spikes, breadboards y vertical slices. Separa problema de solucion antes de comprometerse.', ver:'v2.8.0'},
    {icon:'&#9733;', bg:'rgba(57,210,192,.15)', color:'var(--cyan)', title:'AI Validation Learning', desc:'Sistema de auto-mejora donde los agentes aprenden de cada feature. Preguntas targeted, feedback loop y log de aprendizajes.', ver:'v2.10.0'},
    {icon:'&#9635;', bg:'rgba(219,109,40,.15)', color:'var(--orange)', title:'Capability Providers', desc:'Abstraccion model-agnostic con auto-deteccion. Funciona con cualquier modelo Claude, adaptando paralelizacion, contexto y estrategia de fork.', ver:'v2.7.0'},
    {icon:'&#10003;', bg:'rgba(63,185,80,.15)', color:'var(--green)', title:'Spec-Driven Development', desc:'Contratos API definidos antes de implementacion. Permite desarrollo paralelo frontend/backend. Spec Analyzer valida compliance automaticamente.', ver:'v2.5.0'},
    {icon:'&#8734;', bg:'rgba(88,166,255,.15)', color:'var(--blue)', title:'Compound Engineering', desc:'Cada feature hace que los siguientes sean mas rapidos. Captura de learnings, patrones reutilizables y conocimiento que se compone exponencialmente.', ver:'v1.0.0'},
    {icon:'&#9655;', bg:'rgba(188,140,255,.15)', color:'var(--purple)', title:nCommands + ' Comandos Esenciales', desc:'Surface reducida de 30+ a ' + nCommands + ' comandos. Core flow (6), support (5), automatic (4). Flujo claro sin confusion.', ver:'v3.0.0'},
    {icon:'&#9783;', bg:'rgba(210,153,34,.15)', color:'var(--yellow)', title:'Context Engineering', desc:'Gestion optimizada del context window con activacion selectiva, fork context para agentes pesados y 50_state.md como fuente de verdad.', ver:'v2.0.0'}
  ];

  var agentGroups = [
    {name:'Roles', color:'var(--blue)', bg:'rgba(88,166,255,.15)', items:['Planner','Backend','Frontend','QA']},
    {name:'Review', color:'var(--red)', bg:'rgba(248,81,73,.15)', items:['Security','Performance','DDD Compliance','Code Review TS']},
    {name:'Research', color:'var(--cyan)', bg:'rgba(57,210,192,.15)', items:['Codebase Analyzer','Learnings Researcher']},
    {name:'Workflow', color:'var(--yellow)', bg:'rgba(210,153,34,.15)', items:['Diagnostic Agent','Spec Analyzer']},
    {name:'Design', color:'var(--purple)', bg:'rgba(188,140,255,.15)', items:['API Designer','SOLID Generator','UI Verifier']}
  ];

  var comparisons = [
    ['Planificacion','Ad-hoc, improvisada','Architecture-first, 80% del esfuerzo'],
    ['Correccion de errores','Loop infinito, sin limites','BCP con 3 tipos + limites adaptativos'],
    ['Calidad','Review manual','4 agentes de review automaticos'],
    ['Validacion','Manual, inconsistente','AI Validation Learning (mejora continua)'],
    ['Visibilidad','Cero','Dashboard en tiempo real'],
    ['Sesiones largas','Degradacion de contexto','Context Engineering optimizado'],
    ['Features complejos','Saltar directo a codigo','Shape Up pre-planning'],
    ['Desarrollo paralelo','Imposible','Spec-Driven con contratos API'],
    ['Conocimiento','Se pierde entre features','Compound Engineering (se acumula)'],
    ['Modelos','Atado a un modelo','Capability Providers (model-agnostic)']
  ];

  var methodologies = [
    {title:'Compound Engineering', desc:'Vinci Rufus - Cada iteracion acelera la siguiente'},
    {title:'Bounded Correction Protocol', desc:'Geoffrey Huntley + GSD + BMAD - Loops acotados'},
    {title:'Shape Up', desc:'Ryan Singer - Separar problema de solucion'},
    {title:'Test-Driven Development', desc:'Red - Green - Refactor con enforcement AI'},
    {title:'Domain-Driven Design', desc:'Separacion de capas, compliance automatico'},
    {title:'Spec-Driven Development', desc:'Contratos API primero, implementacion despues'},
    {title:'Context Engineering', desc:'Martin Fowler - Gestion optimizada del context window'}
  ];

  var html = '';

  // Hero
  html += '<div class="pm-hero">' +
    '<div class="pm-badge">PREMIUM FEATURES</div>' +
    '<div class="pm-title">Multi-Agent Workflow v' + esc(D.plugin_info.version || '3.0.0') + '</div>' +
    '<div class="pm-desc">Framework de ingenieria compuesta para desarrollo de software asistido por IA con agentes coordinados en paralelo.</div>' +
    '<div class="pm-stats">' +
      '<div><div class="pm-stat-n">' + nAgents + '</div><div class="pm-stat-l">Agentes AI</div></div>' +
      '<div><div class="pm-stat-n">' + nCommands + '</div><div class="pm-stat-l">Comandos</div></div>' +
      '<div><div class="pm-stat-n">' + nSkills + '</div><div class="pm-stat-l">Skills</div></div>' +
      '<div><div class="pm-stat-n">7</div><div class="pm-stat-l">Metodologias</div></div>' +
      '<div><div class="pm-stat-n">300-700%</div><div class="pm-stat-l">Mejora</div></div>' +
    '</div>' +
  '</div>';

  // Feature cards
  html += '<div class="pm-grid">' + features.map(function(f) {
    return '<div class="pm-card">' +
      '<div class="pm-ico" style="background:' + f.bg + ';color:' + f.color + '">' + f.icon + '</div>' +
      '<h4>' + f.title + '</h4>' +
      '<p>' + f.desc + '</p>' +
      '<div class="pm-ver">' + f.ver + '</div>' +
    '</div>';
  }).join('') + '</div>';

  // Core Flow
  var steps = [
    {n:'ROUTE',w:'Entry point',a:true},{n:'SHAPE',w:'Opcional',a:false},{n:'PLAN',w:'80%',a:false},
    {n:'WORK',w:'15%',a:false},{n:'VALIDATE',w:'Auto',a:false},{n:'REVIEW',w:'4%',a:false},{n:'COMPOUND',w:'1%',a:false}
  ];
  html += '<div class="pm-flow"><div class="pm-flow-title">Core Flow</div><div class="pm-steps">' +
    steps.map(function(s, i) {
      return (i > 0 ? '<span class="pm-arrow">&rarr;</span>' : '') +
        '<div class="pm-step' + (s.a ? ' active' : '') + '"><div class="sn">' + s.n + '</div><div class="sw">' + s.w + '</div></div>';
    }).join('') +
  '</div>' +
  '<div style="margin-top:16px;padding-top:12px;border-top:1px solid var(--bd)">' +
    '<div style="font-size:11px;color:var(--t3);margin-bottom:8px">Alternativa ligera</div>' +
    '<div class="pm-steps">' +
      '<div class="pm-step active"><div class="sn">ROUTE</div><div class="sw">Entry point</div></div>' +
      '<span class="pm-arrow">&rarr;</span>' +
      '<div class="pm-step"><div class="sn">QUICK</div><div class="sw">Tareas simples</div></div>' +
    '</div>' +
  '</div></div>';

  // BCP Section
  html += '<div class="ph"><h2 style="font-size:18px">Bounded Correction Protocol</h2><p>Loop acotado con deteccion inteligente de desviaciones y limites adaptativos.</p></div>';
  html += '<div class="pm-bcp">' +
    '<div class="pm-bcp-card"><div class="pm-bcp-type" style="color:var(--red)">Type 1</div><div class="pm-bcp-name">Test Failure</div><div class="pm-bcp-desc">Fix especifico del test que falla</div></div>' +
    '<div class="pm-bcp-card"><div class="pm-bcp-type" style="color:var(--yellow)">Type 2</div><div class="pm-bcp-name">Missing Functionality</div><div class="pm-bcp-desc">Implementar funcionalidad faltante</div></div>' +
    '<div class="pm-bcp-card"><div class="pm-bcp-type" style="color:var(--purple)">Type 3</div><div class="pm-bcp-name">Incomplete Pattern</div><div class="pm-bcp-desc">Completar patron DDD, naming, etc.</div></div>' +
  '</div>';
  html += '<div class="pm-bcp">' +
    '<div class="pm-bcp-card"><div class="pm-bcp-num" style="color:var(--green)">5</div><div class="pm-bcp-name">Simple</div><div class="pm-bcp-desc">&le; 3 archivos</div></div>' +
    '<div class="pm-bcp-card"><div class="pm-bcp-num" style="color:var(--yellow)">10</div><div class="pm-bcp-name">Moderate</div><div class="pm-bcp-desc">4-10 archivos</div></div>' +
    '<div class="pm-bcp-card"><div class="pm-bcp-num" style="color:var(--red)">15</div><div class="pm-bcp-name">Complex</div><div class="pm-bcp-desc">&gt; 10 archivos</div></div>' +
  '</div>';

  // Agent map
  html += '<div class="ph" style="margin-top:8px"><h2 style="font-size:18px">Mapa de Agentes</h2><p>' + nAgents + ' agentes organizados en 5 categorias, invocados automaticamente.</p></div>';
  html += '<div class="pm-agents">' + agentGroups.map(function(g) {
    return '<div class="pm-ag">' +
      '<div class="pm-ag-title">' + g.name + ' <span class="pm-ag-count" style="background:' + g.bg + ';color:' + g.color + '">' + g.items.length + '</span></div>' +
      g.items.map(function(item) {
        return '<div class="pm-ag-item"><span class="pm-ag-dot" style="background:' + g.color + '"></span>' + item + '</div>';
      }).join('') +
    '</div>';
  }).join('') + '</div>';

  // Compound Engineering chart
  html += '<div class="pm-compound">' +
    '<div class="pm-compound-title">Compound Engineering - Efecto Acumulativo</div>' +
    '<div class="pm-compound-bar"><div class="lbl">Feature 1</div><div class="bar"><div class="fill" style="width:15%;background:var(--blue)"></div></div><div class="sub">Baseline</div></div>' +
    '<div class="pm-compound-bar"><div class="lbl">Feature 5</div><div class="bar"><div class="fill" style="width:45%;background:var(--green)"></div></div><div class="sub">2-3x (patrones establecidos)</div></div>' +
    '<div class="pm-compound-bar"><div class="lbl">Feature 10+</div><div class="bar"><div class="fill" style="width:85%;background:var(--cyan)"></div></div><div class="sub">3-7x (compound effect completo)</div></div>' +
  '</div>';

  // Comparison
  html += '<div class="ph"><h2 style="font-size:18px">Comparativa</h2><p>Desarrollo sin workflow vs con Premium Features.</p></div>';
  html += '<div class="pm-cmp card"><table><thead><tr><th>Aspecto</th><th>Sin Workflow</th><th>Con Premium</th></tr></thead><tbody>' +
    comparisons.map(function(row) {
      return '<tr><td style="font-weight:500">' + row[0] + '</td><td class="c-no">' + row[1] + '</td><td class="c-yes">' + row[2] + '</td></tr>';
    }).join('') +
  '</tbody></table></div>';

  // Methodologies
  html += '<div class="ph"><h2 style="font-size:18px">7 Metodologias Integradas</h2><p>La sintesis de las metodologias mas avanzadas en desarrollo AI.</p></div>';
  html += '<div class="pm-meth">' + methodologies.map(function(m) {
    return '<div class="pm-meth-card"><h4>' + m.title + '</h4><p>' + m.desc + '</p></div>';
  }).join('') + '</div>';

  // Footer
  html += '<div style="text-align:center;padding:24px 0;font-size:11px;color:var(--t3)">Multi-Agent Workflow Plugin v' + esc(D.plugin_info.version || '3.0.0') + ' &middot; Febrero 2026</div>';

  c.innerHTML = html;
}

// Start
go('overview');
</script>
</body>
</html>
