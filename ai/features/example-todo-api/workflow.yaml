metadata:
  name: "Example: TODO API"
  id: "example-todo-api"
  description: "Example feature - Simple REST API for managing TODO items"
  created: "2026-01-15"
  status: "active"

roles:
  - id: planner
    name: "Planner"
    description: "Defines the TODO API feature, creates tasks, makes architectural decisions"

  - id: backend
    name: "Backend Developer"
    description: "Implements the REST API endpoints"

  - id: qa
    name: "QA/Reviewer"
    description: "Reviews implementation, validates API contracts"

stages:
  - id: planning
    name: "Planning & Definition"
    owner: planner
    workspace: "./ai/features/example-todo-api/"
    permissions:
      read:
        - "./ai/**"
        - "./src/**"
      write:
        - "./ai/features/example-todo-api/definition.md"
        - "./ai/features/example-todo-api/tasks.md"
        - "./ai/features/example-todo-api/planner_state.md"
    dependencies: []
    parallel: false
    state_file: "planner_state.md"
    outputs:
      - "definition.md"
      - "tasks.md"

  - id: implementation
    name: "Backend Implementation"
    owner: backend
    workspace: "./src/"
    permissions:
      read:
        - "./ai/**"
        - "./src/**"
      write:
        - "./src/**"
        - "./ai/features/example-todo-api/backend_state.md"
    dependencies: ["planning"]
    parallel: false
    state_file: "backend_state.md"
    outputs:
      - "REST API implementation"

  - id: review
    name: "QA & Review"
    owner: qa
    workspace: "./"
    permissions:
      read:
        - "./ai/**"
        - "./src/**"
        - "./tests/**"
      write:
        - "./ai/features/example-todo-api/qa_state.md"
        - "./ai/features/example-todo-api/review.md"
    dependencies: ["implementation"]
    parallel: false
    state_file: "qa_state.md"
    outputs:
      - "review.md"

validation:
  required_files:
    - "definition.md"
    - "tasks.md"
    - "planner_state.md"
  state_format: "markdown"
  allow_parallel_writes: false

instructions:
  planning:
    prompt: |
      You are the PLANNER for the TODO API feature.

      Your responsibilities:
      1. Read this workflow.yaml to understand the feature
      2. Create detailed `definition.md` with:
         - Feature overview (REST API for TODO items)
         - API endpoints specification:
           * GET /todos - List all todos
           * GET /todos/:id - Get single todo
           * POST /todos - Create todo
           * PUT /todos/:id - Update todo
           * DELETE /todos/:id - Delete todo
         - Data model (Todo: id, title, description, completed, createdAt)
         - Acceptance criteria (checklist)
      3. Create `tasks.md` with specific implementation tasks
      4. Update `planner_state.md` with status: COMPLETED

      DO NOT implement code. Only plan and define.

      After completing, commit your work:
      git add ai/features/example-todo-api/
      git commit -m "Planning: TODO API feature"
      git push

  implementation:
    prompt: |
      You are the BACKEND DEVELOPER for the TODO API feature.

      Your responsibilities:
      1. First, sync: git pull
      2. Read `definition.md` and `tasks.md` from the Planner
      3. Implement REST API in ./src/:
         - Todo model/entity
         - CRUD endpoints (GET, POST, PUT, DELETE)
         - In-memory storage (array) is fine for this example
         - Basic error handling
      4. Update `backend_state.md` with:
         - Completed tasks (checklist)
         - Files created/modified
         - Any technical decisions made

      Follow the API specification from definition.md strictly.

      After completing, commit your work:
      git add src/ ai/features/example-todo-api/backend_state.md
      git commit -m "Implementation: TODO API endpoints"
      git push

  review:
    prompt: |
      You are the QA/REVIEWER for the TODO API feature.

      Your responsibilities:
      1. First, sync: git pull
      2. Read `definition.md` to understand expectations
      3. Review the implementation in ./src/
      4. Verify:
         - All API endpoints are implemented
         - Data model matches specification
         - Error handling is present
         - Code is clean and maintainable
      5. Create `review.md` with:
         - ‚úÖ Aspects that meet requirements
         - ‚ùå Issues found
         - üí° Suggestions for improvement
      6. Update `qa_state.md` with status: APPROVED or REJECTED

      DO NOT fix code yourself. Report issues for the Backend Developer.

      After completing, commit your review:
      git add ai/features/example-todo-api/
      git commit -m "Review: TODO API feature"
      git push
